<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منقذك -O</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="./heart.png">
    <style>
        :root {
            --primary: #1a5276;
            --primary-light: #2980b9;
            --secondary: #16a085;
            --accent: #e74c3c;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Tajawal', 'Arial', sans-serif;
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.7;
            font-weight: 600;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path fill="rgba(255,255,255,0.05)" d="M0,0 L100,0 L100,100 L0,100 Z" /></svg>');
            background-size: cover;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .app-logo {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .app-logo i {
            margin-left: 15px;
            font-size: 32px;
        }
        
        .app-description {
            font-size: 16px;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            font-weight: 600;
        }
        
        /* Main Content */
        .data-entry-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        /* Data Entry Card */
        .data-card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transition: var(--transition);
        }
        
        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 18px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-left: 12px;
            font-size: 20px;
        }
        
        .card-required {
            background: white;
            color: var(--accent);
            font-size: 12px;
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .card-body {
            padding: 25px;
        }
        
        /* Input Styles */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group:last-child {
            margin-bottom: 0;
        }
        
        .input-label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 15px;
        }
        
        .input-field {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 15px;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(41, 128, 185, 0.2);
        }
        
        textarea.input-field {
            min-height: 100px;
            resize: vertical;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .checkbox-input {
            margin-left: 10px;
            width: 18px;
            height: 18px;
        }
        
        .checkbox-label {
            font-size: 14px;
            font-weight: 600;
        }
        
        .select-field {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 15px;
            background: white;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 15px;
            font-weight: 600;
        }
        
        /* Blood Type Selector */
        .blood-type-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .blood-type-option {
            position: relative;
        }
        
        .blood-type-input {
            position: absolute;
            opacity: 0;
        }
        
        .blood-type-label {
            display: block;
            padding: 12px 5px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .blood-type-input:checked + .blood-type-label {
            border-color: var(--primary);
            background-color: rgba(41, 128, 185, 0.1);
            color: var(--primary);
        }
        
        /* Submit Button */
        .submit-section {
            text-align: center;
            margin-top: 40px;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, var(--secondary), #1abc9c);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(22, 160, 133, 0.3);
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(22, 160, 133, 0.4);
        }
        
        .submit-btn i {
            margin-right: 10px;
        }
        
        /* Footer */
        .app-footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            color: var(--gray);
            font-size: 14px;
            border-top: 1px solid #eee;
            font-weight: 600;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .data-entry-container {
                grid-template-columns: 1fr;
            }
            
            .blood-type-selector {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Hidden iframe for WhatsApp */
        .whatsapp-iframe {
            display: none;
        }

        /* Success Message */
        .success-message {
            background: #2ecc71;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
            font-weight: 600;
        }

        /* Error Message */
        .error-message {
            color: var(--accent);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="app-logo">
                <i class="fas fa-hospital-alt"></i>
                <span>نظام منقذك -O</span>
            </div>
            <p class="app-description">الرجاء إدخال البيانات الطبية المطلوبة بدقة للحصول على أفضل رعاية صحية</p>
        </div>
    </header>
    
    <div class="container">
        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <i class="fas fa-check-circle"></i> تم حفظ البيانات وإرسالها بنجاح
        </div>

        <!-- Hidden iframe for WhatsApp API -->
        <iframe id="whatsappIframe" class="whatsapp-iframe"></iframe>

        <form id="medicalForm">
            <div class="data-entry-container">
                <!-- First Name -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-user"></i>
                            الاسم الأول
                        </h3>
                        <span class="card-required">مطلوب</span>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="firstName" class="input-label">الاسم الأول</label>
                            <input type="text" id="firstName" class="input-field" placeholder="أدخل الاسم الأول" required>
                            <div id="firstNameError" class="error-message">الرجاء إدخال الاسم الأول</div>
                        </div>
                    </div>
                </div>

                <!-- Last Name -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-user"></i>
                            الاسم الثاني
                        </h3>
                        <span class="card-required">مطلوب</span>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="lastName" class="input-label">الاسم الثاني</label>
                            <input type="text" id="lastName" class="input-field" placeholder="أدخل الاسم الثاني" required>
                            <div id="lastNameError" class="error-message">الرجاء إدخال الاسم الثاني</div>
                        </div>
                    </div>
                </div>
                
                <!-- Chronic Diseases -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-heartbeat"></i>
                            الأمراض المزمنة
                        </h3>
                        <span class="card-required">مطلوب</span>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="chronicDiseases" class="input-label">هل تعاني من أي أمراض مزمنة؟</label>
                            <select id="chronicDiseases" class="select-field" required>
                                <option value="" selected disabled>اختر الإجابة</option>
                                <option value="no">لا</option>
                                <option value="yes">نعم</option>
                            </select>
                            <div id="chronicDiseasesError" class="error-message">هذا الحقل مطلوب</div>
                        </div>
                        
                        <div class="input-group" id="chronicDetailsGroup" style="display: none;">
                            <label for="chronicDetails" class="input-label">الرجاء ذكر الأمراض والعلاجات</label>
                            <textarea id="chronicDetails" class="input-field" placeholder="مثال: أعاني من السكري النوع الثاني وأتناول ميتفورمين 500 مجم مرتين يوميًا"></textarea>
                            <div id="chronicDetailsError" class="error-message">الرجاء إدخال تفاصيل الأمراض المزمنة</div>
                        </div>
                    </div>
                </div>
                
                <!-- Previous Surgeries -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-procedures"></i>
                            العمليات السابقة
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="previousSurgeries" class="input-label">هل أجريت أي عمليات جراحية سابقة؟</label>
                            <select id="previousSurgeries" class="select-field" required>
                                <option value="" selected disabled>اختر الإجابة</option>
                                <option value="no">لا</option>
                                <option value="yes">نعم</option>
                            </select>
                            <div id="previousSurgeriesError" class="error-message">هذا الحقل مطلوب</div>
                        </div>
                        
                        <div class="input-group" id="surgeryDetailsGroup" style="display: none;">
                            <label for="surgeryDetails" class="input-label">تفاصيل العمليات والعلاجات الحالية</label>
                            <textarea id="surgeryDetails" class="input-field" placeholder="مثال: قمت بعملية قلب مفتوح عام 2018 وأتناول وارفارين 5 مجم يوميًا"></textarea>
                            <div id="surgeryDetailsError" class="error-message">الرجاء إدخال تفاصيل العمليات</div>
                        </div>
                    </div>
                </div>
                
                <!-- Blood Type -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-tint"></i>
                            فصيلة الدم
                        </h3>
                        <span class="card-required">مطلوب</span>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label class="input-label">اختر فصيلة الدم</label>
                            <div class="blood-type-selector">
                                <div class="blood-type-option">
                                    <input type="radio" id="bloodA+" name="bloodType" value="A+" class="blood-type-input" required>
                                    <label for="bloodA+" class="blood-type-label">A+</label>
                                </div>
                                <div class="blood-type-option">
                                    <input type="radio" id="bloodA-" name="bloodType" value="A-" class="blood-type-input">
                                    <label for="bloodA-" class="blood-type-label">A-</label>
                                </div>
                                <div class="blood-type-option">
                                    <input type="radio" id="bloodB+" name="bloodType" value="B+" class="blood-type-input">
                                    <label for="bloodB+" class="blood-type-label">B+</label>
                                </div>
                                <div class="blood-type-option">
                                    <input type="radio" id="bloodB-" name="bloodType" value="B-" class="blood-type-input">
                                    <label for="bloodB-" class="blood-type-label">B-</label>
                                </div>
                                <div class="blood-type-option">
                                    <input type="radio" id="bloodAB+" name="bloodType" value="AB+" class="blood-type-input">
                                    <label for="bloodAB+" class="blood-type-label">AB+</label>
                                </div>
                                <div class="blood-type-option">
                                    <input type="radio" id="bloodAB-" name="bloodType" value="AB-" class="blood-type-input">
                                    <label for="bloodAB-" class="blood-type-label">AB-</label>
                                </div>
                                <div class="blood-type-option">
                                    <input type="radio" id="bloodO+" name="bloodType" value="O+" class="blood-type-input">
                                    <label for="bloodO+" class="blood-type-label">O+</label>
                                </div>
                                <div class="blood-type-option">
                                    <input type="radio" id="bloodO-" name="bloodType" value="O-" class="blood-type-input">
                                    <label for="bloodO-" class="blood-type-label">O-</label>
                                </div>
                            </div>
                            <div id="bloodTypeError" class="error-message">الرجاء اختيار فصيلة الدم</div>
                        </div>
                    </div>
                </div>
                
                <!-- Relapses -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-file-medical"></i>
                            الانتكاسات الصحية
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="healthRelapses" class="input-label">هل تعرضت لأي انتكاسات صحية؟</label>
                            <select id="healthRelapses" class="select-field" required>
                                <option value="" selected disabled>اختر الإجابة</option>
                                <option value="no">لا</option>
                                <option value="yes">نعم</option>
                            </select>
                            <div id="healthRelapsesError" class="error-message">هذا الحقل مطلوب</div>
                        </div>
                        
                        <div class="input-group" id="relapseDetailsGroup" style="display: none;">
                            <label for="relapseDetails" class="input-label">تفاصيل الانتكاسات والعلاجات</label>
                            <textarea id="relapseDetails" class="input-field" placeholder="مثال: تعرضت لجلطة دماغية عام 2020 وأتناول أسبرين 81 مجم يوميًا"></textarea>
                            <div id="relapseDetailsError" class="error-message">الرجاء إدخال تفاصيل الانتكاسات</div>
                        </div>
                    </div>
                </div>
                
                <!-- Disabilities -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-wheelchair"></i>
                            الإعاقات
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="disabilities" class="input-label">هل لديك أي إعاقات؟</label>
                            <select id="disabilities" class="select-field" required>
                                <option value="" selected disabled>اختر الإجابة</option>
                                <option value="no">لا</option>
                                <option value="yes">نعم</option>
                            </select>
                            <div id="disabilitiesError" class="error-message">هذا الحقل مطلوب</div>
                        </div>
                        
                        <div class="input-group" id="disabilityDetailsGroup" style="display: none;">
                            <label for="disabilityDetails" class="input-label">تفاصيل الإعاقة</label>
                            <textarea id="disabilityDetails" class="input-field" placeholder="مثال: أعاني من شلل نصفي في الجانب الأيمن منذ الولادة"></textarea>
                            <div id="disabilityDetailsError" class="error-message">الرجاء إدخال تفاصيل الإعاقة</div>
                        </div>
                    </div>
                </div>
                
                <!-- Health Insurance -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-shield-alt"></i>
                            التأمين الصحي
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="insuranceProvider" class="input-label">مقدم خدمة التأمين الصحي</label>
                            <input type="text" id="insuranceProvider" class="input-field" placeholder="مثال: مستشفى ناصر">
                        </div>
                        
                        <div class="input-group">
                            <label for="insuranceNumber" class="input-label">رقم بوليصة التأمين (إن وجد)</label>
                            <input type="text" id="insuranceNumber" class="input-field" placeholder="رقم البوليصة">
                        </div>
                    </div>
                </div>
                
                <!-- Allergies -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-allergies"></i>
                            الحساسية
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="hasAllergies" class="input-label">هل لديك حساسية من أي أدوية أو أطعمة؟</label>
                            <select id="hasAllergies" class="select-field" required>
                                <option value="" selected disabled>اختر الإجابة</option>
                                <option value="no">لا</option>
                                <option value="yes">نعم</option>
                            </select>
                            <div id="hasAllergiesError" class="error-message">هذا الحقل مطلوب</div>
                        </div>
                        
                        <div class="input-group" id="allergyDetailsGroup" style="display: none;">
                            <label for="allergyDetails" class="input-label">تفاصيل الحساسية</label>
                            <textarea id="allergyDetails" class="input-field" placeholder="مثال: حساسية من البنسلين (تسبب طفح جلدي)"></textarea>
                            <div id="allergyDetailsError" class="error-message">الرجاء إدخال تفاصيل الحساسية</div>
                        </div>
                    </div>
                </div>
                
                <!-- Infectious Diseases -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-virus"></i>
                            الأمراض المعدية
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="infectiousDiseases" class="input-label">هل لديك أي أمراض معدية معروفة؟</label>
                            <select id="infectiousDiseases" class="select-field" required>
                                <option value="" selected disabled>اختر الإجابة</option>
                                <option value="no">لا</option>
                                <option value="yes">نعم</option>
                            </select>
                            <div id="infectiousDiseasesError" class="error-message">هذا الحقل مطلوب</div>
                        </div>
                        
                        <div class="input-group" id="diseaseDetailsGroup" style="display: none;">
                            <label for="diseaseDetails" class="input-label">تفاصيل الأمراض المعدية</label>
                            <textarea id="diseaseDetails" class="input-field" placeholder="مثال: التهاب كبدي فيروسي نوع ب"></textarea>
                            <div id="diseaseDetailsError" class="error-message">الرجاء إدخال تفاصيل الأمراض المعدية</div>
                        </div>
                    </div>
                </div>
                
                <!-- Vaccinations -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-syringe"></i>
                            التطعيمات
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="hasVaccinations" class="input-label">هل تلقيت تطعيمات ضد أمراض معينة؟</label>
                            <select id="hasVaccinations" class="select-field" required>
                                <option value="" selected disabled>اختر الإجابة</option>
                                <option value="no">لا</option>
                                <option value="yes">نعم</option>
                            </select>
                            <div id="hasVaccinationsError" class="error-message">هذا الحقل مطلوب</div>
                        </div>
                        
                        <div class="input-group" id="vaccinationDetailsGroup" style="display: none;">
                            <label for="vaccinationDetails" class="input-label">تفاصيل التطعيمات</label>
                            <textarea id="vaccinationDetails" class="input-field" placeholder="مثال: تطعيم ضد كوفيد-19 (جرعتين)، تطعيم الإنفلونزا الموسمية 2023"></textarea>
                            <div id="vaccinationDetailsError" class="error-message">الرجاء إدخال تفاصيل التطعيمات</div>
                        </div>
                    </div>
                </div>
                
                <!-- Phone Numbers -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-phone-alt"></i>
                            أرقام الهواتف للطوارئ
                        </h3>
                        <span class="card-required">مطلوب</span>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="phone1" class="input-label">رقم الهاتف الأول</label>
                            <input type="tel" id="phone1" class="input-field" placeholder="مثال: 01001234567" required>
                            <div id="phone1Error" class="error-message">الرجاء إدخال رقم هاتف صحيح</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="phone1Owner" class="input-label">صاحب الرقم الأول</label>
                            <input type="text" id="phone1Owner" class="input-field" placeholder="مثال: أحمد محمد (الابن)" required>
                            <div id="phone1OwnerError" class="error-message">الرجاء إدخال اسم صاحب الرقم</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="phone2" class="input-label">رقم الهاتف الثاني</label>
                            <input type="tel" id="phone2" class="input-field" placeholder="مثال: 01007654321">
                            <div id="phone2Error" class="error-message">الرجاء إدخال رقم هاتف صحيح</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="phone2Owner" class="input-label">صاحب الرقم الثاني</label>
                            <input type="text" id="phone2Owner" class="input-field" placeholder="مثال: سميرة أحمد (الزوجة)">
                        </div>
                    </div>
                </div>

                <!-- Other Problems -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-question-circle"></i>
                            مشاكل أخرى
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="otherProblems" class="input-label">هل تعاني من أي مشاكل أخرى؟ (نفسية أو مرضية)</label>
                            <select id="otherProblems" class="select-field" required>
                                <option value="" selected disabled>اختر الإجابة</option>
                                <option value="no">لا</option>
                                <option value="yes">نعم</option>
                            </select>
                            <div id="otherProblemsError" class="error-message">هذا الحقل مطلوب</div>
                        </div>
                        
                        <div class="input-group" id="otherProblemsDetailsGroup" style="display: none;">
                            <label for="otherProblemsDetails" class="input-label">تفاصيل المشاكل الأخرى</label>
                            <textarea id="otherProblemsDetails" class="input-field" placeholder="مثال: أعاني من نوبات قلق متكررة، لدي مشكلة في النوم"></textarea>
                            <div id="otherProblemsDetailsError" class="error-message">الرجاء إدخال تفاصيل المشاكل</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Submit Button -->
            <div class="submit-section">
                <button type="submit" class="submit-btn" id="submitBtn">
                    <i class="fas fa-save"></i>
                    حفظ البيانات
                </button>
            </div>
        </form>
        
        <footer class="app-footer">
            <p>© 2023 نظام منقذك -O. جميع الحقوق محفوظة.</p>
        </footer>
    </div>
    
    <script>
        // Show/hide details fields based on selection
        document.getElementById('chronicDiseases').addEventListener('change', function() {
            document.getElementById('chronicDetailsGroup').style.display = this.value === 'yes' ? 'block' : 'none';
            if(this.value === 'yes') {
                document.getElementById('chronicDetails').setAttribute('required', 'required');
            } else {
                document.getElementById('chronicDetails').removeAttribute('required');
            }
        });
        
        document.getElementById('previousSurgeries').addEventListener('change', function() {
            document.getElementById('surgeryDetailsGroup').style.display = this.value === 'yes' ? 'block' : 'none';
            if(this.value === 'yes') {
                document.getElementById('surgeryDetails').setAttribute('required', 'required');
            } else {
                document.getElementById('surgeryDetails').removeAttribute('required');
            }
        });
        
        document.getElementById('healthRelapses').addEventListener('change', function() {
            document.getElementById('relapseDetailsGroup').style.display = this.value === 'yes' ? 'block' : 'none';
            if(this.value === 'yes') {
                document.getElementById('relapseDetails').setAttribute('required', 'required');
            } else {
                document.getElementById('relapseDetails').removeAttribute('required');
            }
        });
        
        document.getElementById('disabilities').addEventListener('change', function() {
            document.getElementById('disabilityDetailsGroup').style.display = this.value === 'yes' ? 'block' : 'none';
            if(this.value === 'yes') {
                document.getElementById('disabilityDetails').setAttribute('required', 'required');
            } else {
                document.getElementById('disabilityDetails').removeAttribute('required');
            }
        });
        
        document.getElementById('hasAllergies').addEventListener('change', function() {
            document.getElementById('allergyDetailsGroup').style.display = this.value === 'yes' ? 'block' : 'none';
            if(this.value === 'yes') {
                document.getElementById('allergyDetails').setAttribute('required', 'required');
            } else {
                document.getElementById('allergyDetails').removeAttribute('required');
            }
        });
        
        document.getElementById('infectiousDiseases').addEventListener('change', function() {
            document.getElementById('diseaseDetailsGroup').style.display = this.value === 'yes' ? 'block' : 'none';
            if(this.value === 'yes') {
                document.getElementById('diseaseDetails').setAttribute('required', 'required');
            } else {
                document.getElementById('diseaseDetails').removeAttribute('required');
            }
        });
        
        document.getElementById('hasVaccinations').addEventListener('change', function() {
            document.getElementById('vaccinationDetailsGroup').style.display = this.value === 'yes' ? 'block' : 'none';
            if(this.value === 'yes') {
                document.getElementById('vaccinationDetails').setAttribute('required', 'required');
            } else {
                document.getElementById('vaccinationDetails').removeAttribute('required');
            }
        });

        document.getElementById('otherProblems').addEventListener('change', function() {
            document.getElementById('otherProblemsDetailsGroup').style.display = this.value === 'yes' ? 'block' : 'none';
            if(this.value === 'yes') {
                document.getElementById('otherProblemsDetails').setAttribute('required', 'required');
            } else {
                document.getElementById('otherProblemsDetails').removeAttribute('required');
            }
        });
        
        // Form submission with WhatsApp integration
        document.getElementById('medicalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Reset errors
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.input-field, .select-field').forEach(el => el.classList.remove('input-error'));
            
            let isValid = true;
            
            // Validate required fields
            const requiredFields = [
                'firstName', 'lastName', 'chronicDiseases', 'previousSurgeries', 
                'healthRelapses', 'disabilities', 'hasAllergies', 'infectiousDiseases', 
                'hasVaccinations', 'phone1', 'phone1Owner', 'otherProblems'
            ];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value) {
                    field.classList.add('input-error');
                    document.getElementById(`${fieldId}Error`).style.display = 'block';
                    isValid = false;
                }
            });
            
            // Validate blood type
            const bloodTypeSelected = document.querySelector('input[name="bloodType"]:checked');
            if (!bloodTypeSelected) {
                document.getElementById('bloodTypeError').style.display = 'block';
                isValid = false;
            }
            
            // Validate phone numbers format
            const phone1 = document.getElementById('phone1').value;
            if (phone1 && !/^01[0125][0-9]{8}$/.test(phone1)) {
                document.getElementById('phone1').classList.add('input-error');
                document.getElementById('phone1Error').style.display = 'block';
                isValid = false;
            }
            
            const phone2 = document.getElementById('phone2').value;
            if (phone2 && !/^01[0125][0-9]{8}$/.test(phone2)) {
                document.getElementById('phone2').classList.add('input-error');
                document.getElementById('phone2Error').style.display = 'block';
                isValid = false;
            }
            
            // Validate details fields when "yes" is selected
            const conditionalFields = [
                {field: 'chronicDiseases', details: 'chronicDetails'},
                {field: 'previousSurgeries', details: 'surgeryDetails'},
                {field: 'healthRelapses', details: 'relapseDetails'},
                {field: 'disabilities', details: 'disabilityDetails'},
                {field: 'hasAllergies', details: 'allergyDetails'},
                {field: 'infectiousDiseases', details: 'diseaseDetails'},
                {field: 'hasVaccinations', details: 'vaccinationDetails'},
                {field: 'otherProblems', details: 'otherProblemsDetails'}
            ];
            
            conditionalFields.forEach(item => {
                const field = document.getElementById(item.field);
                const detailsField = document.getElementById(item.details);
                
                if (field && field.value === 'yes' && (!detailsField || !detailsField.value)) {
                    detailsField.classList.add('input-error');
                    document.getElementById(`${item.details}Error`).style.display = 'block';
                    isValid = false;
                }
            });
            
            if (!isValid) {
                // Scroll to first error
                const firstError = document.querySelector('.input-error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<span class="spinner"></span> جاري الإرسال...';
            submitBtn.disabled = true;
            
            // Collect all form data
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                chronicDiseases: document.getElementById('chronicDiseases').value,
                chronicDetails: document.getElementById('chronicDetails').value,
                previousSurgeries: document.getElementById('previousSurgeries').value,
                surgeryDetails: document.getElementById('surgeryDetails').value,
                bloodType: document.querySelector('input[name="bloodType"]:checked')?.value,
                healthRelapses: document.getElementById('healthRelapses').value,
                relapseDetails: document.getElementById('relapseDetails').value,
                disabilities: document.getElementById('disabilities').value,
                disabilityDetails: document.getElementById('disabilityDetails').value,
                insuranceProvider: document.getElementById('insuranceProvider').value,
                insuranceNumber: document.getElementById('insuranceNumber').value,
                hasAllergies: document.getElementById('hasAllergies').value,
                allergyDetails: document.getElementById('allergyDetails').value,
                infectiousDiseases: document.getElementById('infectiousDiseases').value,
                diseaseDetails: document.getElementById('diseaseDetails').value,
                hasVaccinations: document.getElementById('hasVaccinations').value,
                vaccinationDetails: document.getElementById('vaccinationDetails').value,
                phone1: document.getElementById('phone1').value,
                phone1Owner: document.getElementById('phone1Owner').value,
                phone2: document.getElementById('phone2').value,
                phone2Owner: document.getElementById('phone2Owner').value,
                otherProblems: document.getElementById('otherProblems').value,
                otherProblemsDetails: document.getElementById('otherProblemsDetails').value
            };
            
            // Format the message for WhatsApp
            let whatsappMessage = `*بيانات المريض الطارئة - نظام منقذك -O*\n\n`;
            whatsappMessage += `*الاسم:* ${formData.firstName} ${formData.lastName}\n`;
            whatsappMessage += `*فصيلة الدم:* ${formData.bloodType || 'غير محددة'}\n\n`;
            
            whatsappMessage += `*الأمراض المزمنة:* ${formData.chronicDiseases === 'yes' ? formData.chronicDetails : 'لا'}\n`;
            whatsappMessage += `*العمليات السابقة:* ${formData.previousSurgeries === 'yes' ? formData.surgeryDetails : 'لا'}\n`;
            whatsappMessage += `*الانتكاسات الصحية:* ${formData.healthRelapses === 'yes' ? formData.relapseDetails : 'لا'}\n`;
            whatsappMessage += `*الإعاقات:* ${formData.disabilities === 'yes' ? formData.disabilityDetails : 'لا'}\n\n`;
            
            whatsappMessage += `*الحساسية:* ${formData.hasAllergies === 'yes' ? formData.allergyDetails : 'لا'}\n`;
            whatsappMessage += `*الأمراض المعدية:* ${formData.infectiousDiseases === 'yes' ? formData.diseaseDetails : 'لا'}\n`;
            whatsappMessage += `*التطعيمات:* ${formData.hasVaccinations === 'yes' ? formData.vaccinationDetails : 'لا'}\n\n`;
            
            whatsappMessage += `*مشاكل أخرى:* ${formData.otherProblems === 'yes' ? formData.otherProblemsDetails : 'لا'}\n\n`;
            
            whatsappMessage += `*معلومات التأمين:* ${formData.insuranceProvider || 'غير محدد'} ${formData.insuranceNumber ? `(رقم البوليصة: ${formData.insuranceNumber})` : ''}\n\n`;
            
            whatsappMessage += `*أرقام الطوارئ:*\n`;
            whatsappMessage += `1. ${formData.phone1Owner}: ${formData.phone1}\n`;
            if (formData.phone2) {
                whatsappMessage += `2. ${formData.phone2Owner || 'غير محدد'}: ${formData.phone2}\n`;
            }
            
            // Encode the message for URL
            const encodedMessage = encodeURIComponent(whatsappMessage);
            
            // WhatsApp phone number
            const whatsappNumber = '01288252692';
            
            // Create WhatsApp link
            const whatsappUrl = `https://wa.me/2${whatsappNumber}?text=${encodedMessage}`;
            
            // Use iframe to send the message (works if user has WhatsApp Web open)
            const iframe = document.getElementById('whatsappIframe');
            iframe.src = whatsappUrl;
            
            // Also open in new tab as fallback
            window.open(whatsappUrl, '_blank');
            
            // Show success message
            setTimeout(() => {
                const successMessage = document.getElementById('successMessage');
                successMessage.style.display = 'block';
                
                // Scroll to success message
                successMessage.scrollIntoView({ behavior: 'smooth' });
                
                // Reset submit button
                submitBtn.innerHTML = '<i class="fas fa-save"></i> حفظ البيانات';
                submitBtn.disabled = false;
                
                // Reset form
                document.getElementById('medicalForm').reset();
            }, 2000);
        });
    </script>
</body>
</html>